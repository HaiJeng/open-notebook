DEFINE TABLE IF NOT EXISTS episode_profile SCHEMAFULL;
DEFINE FIELD IF NOT EXISTS name ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS description ON TABLE episode_profile TYPE option<string>;
DEFINE FIELD IF NOT EXISTS speaker_config ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS outline_provider ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS outline_model ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS transcript_provider ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS transcript_model ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS default_briefing ON TABLE episode_profile TYPE string;
DEFINE FIELD IF NOT EXISTS num_segments ON TABLE episode_profile TYPE int DEFAULT 5;
DEFINE FIELD IF NOT EXISTS created ON TABLE episode_profile TYPE datetime DEFAULT time::now();
DEFINE FIELD IF NOT EXISTS updated ON TABLE episode_profile TYPE datetime DEFAULT time::now();

-- Create Speaker Profile table
remove table speaker_profile;
DEFINE TABLE IF NOT EXISTS speaker_profile SCHEMAFULL;
DEFINE FIELD IF NOT EXISTS name ON TABLE speaker_profile TYPE string;
DEFINE FIELD IF NOT EXISTS description ON TABLE speaker_profile TYPE option<string>;
DEFINE FIELD IF NOT EXISTS tts_provider ON TABLE speaker_profile TYPE string;
DEFINE FIELD IF NOT EXISTS tts_model ON TABLE speaker_profile TYPE string;
DEFINE FIELD IF NOT EXISTS speakers ON TABLE speaker_profile TYPE array<object>;
DEFINE FIELD IF NOT EXISTS speakers.*.name ON TABLE speaker_profile TYPE string;
DEFINE FIELD IF NOT EXISTS speakers.*.voice_id ON TABLE speaker_profile TYPE option<string>;
DEFINE FIELD IF NOT EXISTS speakers.*.backstory ON TABLE speaker_profile TYPE option<string>;
DEFINE FIELD IF NOT EXISTS speakers.*.personality ON TABLE speaker_profile TYPE option<string>;
DEFINE FIELD IF NOT EXISTS created ON TABLE speaker_profile TYPE datetime DEFAULT time::now();
DEFINE FIELD IF NOT EXISTS updated ON TABLE speaker_profile TYPE datetime DEFAULT time::now();


-- Enhance PodcastEpisode table
DEFINE TABLE IF NOT EXISTS episode SCHEMAFULL;
DEFINE FIELD IF NOT EXISTS created ON episode DEFAULT time::now() VALUE $before OR time::now();
DEFINE FIELD IF NOT EXISTS updated ON episode DEFAULT time::now() VALUE time::now();
DEFINE FIELD IF NOT EXISTS name ON TABLE episode TYPE string;
DEFINE FIELD IF NOT EXISTS briefing ON TABLE episode TYPE option<string>;
DEFINE FIELD IF NOT EXISTS episode_profile ON TABLE episode FLEXIBLE TYPE object;
DEFINE FIELD IF NOT EXISTS speaker_profile ON TABLE episode FLEXIBLE TYPE object;
DEFINE FIELD IF NOT EXISTS transcript ON TABLE episode FLEXIBLE TYPE option<object>;
DEFINE FIELD IF NOT EXISTS outline ON TABLE episode FLEXIBLE TYPE option<object>;
DEFINE FIELD IF NOT EXISTS command ON TABLE episode TYPE option<record<command>>;
DEFINE FIELD IF NOT EXISTS content ON TABLE episode TYPE option<string>;
DEFINE FIELD IF NOT EXISTS audio_file ON TABLE episode TYPE option<string>;

-- Create indexes for better performance
DEFINE INDEX IF NOT EXISTS idx_episode_profile_name ON TABLE episode_profile COLUMNS name UNIQUE CONCURRENTLY;
DEFINE INDEX IF NOT EXISTS idx_speaker_profile_name ON TABLE speaker_profile COLUMNS name UNIQUE CONCURRENTLY;
DEFINE INDEX IF NOT EXISTS idx_episode_profile ON TABLE episode COLUMNS episode_profile CONCURRENTLY;
DEFINE INDEX IF NOT EXISTS idx_episode_command ON TABLE episode COLUMNS command CONCURRENTLY;


--Sample data

insert into episode_profile 
[
            {
                name: "tech_discussion",
                description: "两位专家之间的技术讨论",
                speaker_config: "tech_experts",
                outline_provider: "openai",
                outline_model: "gpt-5-mini",
                transcript_provider: "openai", 
                transcript_model: "gpt-5-mini",
                default_briefing: "创建一个关于所提供内容的引人入胜的技术讨论。关注实用见解、实际应用和详细解释，以吸引开发者和技术专业人士的兴趣。",
                num_segments: 5
            },
            {
                name: "solo_expert",
                description: "单个专家解释复杂主题",
                speaker_config: "solo_expert",
                outline_provider: "openai",
                outline_model: "gpt-5-mini",
                transcript_provider: "openai",
                transcript_model: "gpt-5-mini", 
                default_briefing: "创建所提供内容的教育性解释。将复杂概念分解为易消化的段落，使用类比和示例，并保持引人入胜的教学风格。",
                "num_segments":4            },
            {
                name: "business_analysis",
                description: "以业务为重点的分析和讨论",
                speaker_config: "business_panel",
                outline_provider: "openai",
                outline_model: "gpt-5-mini",
                transcript_provider: "openai",
                transcript_model: "gpt-5-mini",
                default_briefing: "从商业角度分析所提供的内容。讨论市场影响、战略见解、竞争优势和可行的商业智能。",
                "num_segments":6            }
        ];

insert into speaker_profile
[
            {
                name: "tech_experts",
                description: "技术讨论的两位技术专家",
                tts_provider: "openai",
                tts_model: "gpt-4o-mini-tts",
                speakers: [
                    {
                        name: "陈博士",
                        voice_id: "nova",
                        backstory: "资深AI研究员，曾任大公司技术主管。专注于使复杂技术概念易于理解。",
                        personality: "分析性强，表达清晰，善于提出深入的问题以挖掘技术细节"
                    },
                    {
                        name: "杰米·罗德里格斯",
                        voice_id: "alloy", 
                        backstory: "全栈工程师和技术创业者。热衷于实际应用和真实世界的实现。",
                        personality: "热情洋溢，注重实践，善于解释实现细节和权衡利弊"
                    }
                ]
            },
            {
                name: "solo_expert",
                description: "教育内容的单个专家",
                tts_provider: "openai",
                tts_model: "gpt-4o-mini-tts",
                speakers: [
                    {
                        name: "金教授",
                        voice_id: "nova",
                        backstory: "杰出的教授和研究员。具有将复杂主题传达给广泛受众的天赋。",
                        personality: "耐心的教师，善用类比和示例，逐步分解复杂概念"
                    }
                ]
            },
            {
                name: "business_panel",
                description: "具有多元视角的商业分析小组",
                tts_provider: "openai", 
                tts_model: "gpt-4o-mini-tts",
                speakers: [
                    {
                        name: "马库斯·汤普森",
                        voice_id: "echo",
                        backstory: "前麦肯锡顾问，现为创业公司顾问。战略分析和市场动态专家。",
                        personality: "战略思维者，数据驱动，善于识别关键见解和影响"
                    },
                    {
                        name: "埃琳娜·巴斯克斯", 
                        voice_id: "shimmer",
                        backstory: "连续创业者和投资人。专注于实际实施和执行。",
                        personality: "行动导向，务实，带来创业经验和执行力"
                    },
                    {
                        name: "约翰尼·宾", 
                        voice_id: "ash",
                        backstory: "YouTube名人和商业大亨。专注于实际实施和执行。",
                        personality: "有争议性，喜欢质疑想法和概念。带来新鲜视角，总有观点要表达。"
                    }
                ]
            }
        ];


